package com.example.jhalloran.zoo.model.pen;

import static junit.framework.Assert.assertEquals;
import static junit.framework.Assert.assertFalse;
import static junit.framework.Assert.assertTrue;
import static junit.framework.Assert.fail;

import com.example.jhalloran.zoo.model.Zookeeper;
import com.example.jhalloran.zoo.model.animal.Animal;
import com.example.jhalloran.zoo.model.animal.FlyingAnimal;
import com.example.jhalloran.zoo.model.animal.LandAnimal;
import com.example.jhalloran.zoo.model.animal.SwimmingAnimal;
import com.example.jhalloran.zoo.model.shared.PenType;
import com.example.jhalloran.zoo.model.shared.WaterType;
import java.util.Collections;
import java.util.EnumSet;
import org.junit.Before;
import org.junit.Test;

/**
 * Created by jhalloran on 1/9/18.
 */

public final class DryPenTest {
  private static final PenType DEFAULT_TYPE = PenType.DRY;
  private static final String DEFAULT_NAME = "Dry pen";
  private static final int DEFAULT_LENGTH = 5;
  private static final int DEFAULT_WIDTH = 10;
  private static final int DEFAULT_TEMPERATURE = 22;

  private DryPen pen = createDefaultDryPen();

  @Before
  public void setUp() {
    pen = createDefaultDryPen();
  }

  @Test
  public void createDryPenWithDefaults() {
    assertEquals(pen.getName(), DEFAULT_NAME);
    assertEquals(pen.getType(), DEFAULT_TYPE);
    assertEquals(pen.getLandArea(), 50);
    assertEquals(pen.getTemperature(), DEFAULT_TEMPERATURE);
  }

  @Test
  public void addAnimalToPen() {
    Animal cat = new LandAnimal("cat", 10, EnumSet.of(DEFAULT_TYPE));
    assertTrue(pen.addAnimal(cat));
    assertEquals(pen.getAnimals(), Collections.singleton(cat));
  }

  @Test
  public void addSameAnimalTwice_fails() {
    Animal cat = new LandAnimal("cat", 10, EnumSet.of(DEFAULT_TYPE));
    assertTrue(pen.addAnimal(cat));
    assertFalse(pen.addAnimal(cat));
    assertEquals(pen.getAnimals().size(), 1);
  }

  @Test
  public void addAnimalThatIsTooLargeForPen_throws() {
    DryPen smallPen = new DryPen(DEFAULT_NAME, 2, 2, DEFAULT_TEMPERATURE);
    Animal elephant = new LandAnimal("elephant", 50, EnumSet.of(DEFAULT_TYPE));
    assertFalse(smallPen.addAnimal(elephant));
    assertEquals(smallPen.getAnimals().size(), 0);
  }

  @Test
  public void addAnimalWithWrongPenType_throws() {
    Animal cat = new LandAnimal("cat", 50, EnumSet.of(PenType.PETTING));
    assertFalse(pen.addAnimal(cat));
    assertEquals(pen.getAnimals().size(), 0);
  }

  @Test
  public void addFlyingAnimal_throws() {
    FlyingAnimal bird = new FlyingAnimal("bird", 10, 200, EnumSet.of(DEFAULT_TYPE));
    assertFalse(pen.addAnimal(bird));
    assertEquals(pen.getAnimals().size(), 0);
  }

  @Test
  public void addSwimmingAnimal_throws() {
    Animal seal =
        new SwimmingAnimal("seal", 10, 100, EnumSet.of(WaterType.FRESH), EnumSet.of(DEFAULT_TYPE));
    assertFalse(pen.addAnimal(seal));
    assertEquals(pen.getAnimals().size(), 0);
  }

  @Test
  public void removeAnimal() {
    Animal cat = new LandAnimal("cat", 10, EnumSet.of(DEFAULT_TYPE));
    Animal dog = new LandAnimal("dog", 15, EnumSet.of(DEFAULT_TYPE));
    pen.addAnimal(cat);
    pen.addAnimal(dog);

    assertTrue(pen.getAnimals().contains(cat));
    assertTrue(pen.getAnimals().contains(dog));

    pen.removeAnimal(cat);

    assertTrue(pen.getAnimals().contains(dog));
    assertEquals(pen.getAnimals().size(), 1);
  }

  @Test
  public void assignPenToZookeeper() {
    Zookeeper zookeeper = new Zookeeper("Jane", EnumSet.of(DEFAULT_TYPE));
    pen.assignToZookeeper(zookeeper);

    assertTrue(pen.isAssigned());
    assertEquals(pen.getAssignedToZookeeper(), zookeeper);
  }

  @Test
  public void assignPenToSecondZookeeper_updates() {
    Zookeeper zookeeperOne = new Zookeeper("Jane", EnumSet.of(DEFAULT_TYPE));
    Zookeeper zookeeperTwo = new Zookeeper("Fred", EnumSet.of(DEFAULT_TYPE));

    assertTrue(pen.assignToZookeeper(zookeeperOne));
    assertTrue(pen.assignToZookeeper(zookeeperTwo));

    assertEquals(pen.getAssignedToZookeeper(), zookeeperTwo);
    assertTrue(zookeeperTwo.getPens().contains(pen));
    assertFalse(zookeeperOne.getPens().contains(pen));
  }

  @Test
  public void toString_returnType(){
    assertEquals(pen.toString(), DEFAULT_NAME);
  }

  private DryPen createDefaultDryPen() {
    return new DryPen(DEFAULT_NAME, DEFAULT_LENGTH, DEFAULT_WIDTH, DEFAULT_TEMPERATURE);
  }
}

